---
title: "module 6 report"
author: "vroomvroom"
date: "2022-10-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(Momocs)
library(ape)
library(phytools)
library(RRphylo)
library(vroom)
library(ape)
library(ggtree)
library(wesanderson)

```

```{r, include=FALSE}

f <- list.files("class_out_data",pattern=".txt|.csv",full.names = TRUE)

out <- read_delim(f[1],delim="\t") %>% 
  as.matrix()
out %>% 
  list() %>% 
  Out() %>% 
  coo_flipx() %>% 
  stack() 

out.df <- vroom::vroom(f, id = "filename")

out.df <- out.df %>% 
  mutate(wing=gsub("XY_.+_(hindwing|forewing)\\..+","\\1",basename(filename))) %>% 
  na.omit()

outs.l <- sapply(f,function(x) out.df %>% filter(filename==x) %>% select(X,Y) %>% as.matrix)

wings <- gsub("XY_.+_(hindwing|forewing)\\..+","\\1",basename(names(outs.l))) 

outs <-  outs.l %>% 
  Out(fac=list(wing=wings)) %>% 
  coo_flipx()

forewings <- outs %>% 
  filter(wing=="forewing")
hindwings <- outs %>% 
  filter(wing=="hindwing")

forewings %>% 
  stack()
hindwings %>% 
  stack()

fore.min <- forewings %>% 
  coo_nb() %>% 
  min() 


forewings %>%
  coo_interpolate(fore.min) %>%
  fgProcrustes() %>%
  stack()

hind.min <- hindwings %>% 
  coo_nb() %>% 
  min()

hindwings %>% 
  coo_interpolate(hind.min) %>% 
  coo_slide(id=1) %>% 
  coo_align()  %>%
  fgProcrustes() %>%
  stack()
```

```{r, "geeting PCAs"}

forewing.pca <- forewings %>%
  coo_interpolate(fore.min) %>%
  coo_align()  %>%
  coo_slide(id=1) %>% 
  fgProcrustes() %>% 
  efourier(norm=FALSE) %>% 
  PCA()

hindwing.pca <-hindwings %>% 
  coo_interpolate(hind.min) %>% 
  coo_align()  %>%
  coo_slide(id=1) %>% 
  fgProcrustes() %>% 
  efourier(norm=FALSE) %>% 
  PCA()

```


```{r, "plotting PCAs"}

forewing.pca %>% 
  plot_PCA(title = "forewings")

```

## Introduction


## Methods



## Results



## Discussion



## Author Contributions



## References
